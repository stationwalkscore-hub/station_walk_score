<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Station Walk Score</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif; margin: 24px; }
    .card { max-width: 720px; margin: 0 auto; border: 1px solid #e5e7eb; border-radius: 16px; padding: 18px; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .row { display: flex; gap: 8px; align-items: center; }
    input { flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 10px; font-size: 16px; }
    button { padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 10px; background: #fff; cursor: pointer; }
    button:hover { background: #f9fafb; }
    .hint { color: #6b7280; font-size: 13px; margin-top: 8px; }
    .suggest { margin-top: 10px; }
    .suggest-item { padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 10px; margin-top: 8px; cursor: pointer; user-select: none; }
    .suggest-item:hover { background: #f9fafb; }
    .result { margin-top: 14px; padding: 12px; border-radius: 12px; background: #f9fafb; border: 1px solid #e5e7eb; }
    .result .name { font-size: 18px; font-weight: 700; }
    .result .score { margin-top: 6px; font-size: 28px; font-weight: 800; }
    .muted { color: #6b7280; font-size: 13px; }
    .legal { margin-top: 16px; padding-top: 12px; border-top: 1px solid #e5e7eb; }
    .legal-note { color: #6b7280; font-size: 12px; line-height: 1.6; margin: 0 0 10px; }
    .legal h2 { font-size: 14px; margin: 12px 0 6px; }
    .legal p { color: #6b7280; font-size: 12px; line-height: 1.6; margin: 0 0 8px; }
    .error { color: #b91c1c; font-size: 12px; margin-top: 10px; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H10T9QTSXJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-H10T9QTSXJ', {
    anonymize_ip: true
  });
</script>

  
</head>
<body>
  <div class="card">
    <h1>Station Walk Score</h1>

    <div class="row">
      <input id="q" type="text" placeholder="駅名を入力（例：東京）" autocomplete="off" />
      <button id="btn">表示</button>
    </div>
    <div class="hint">候補は最大3件まで表示します。候補をクリックして確定できます。</div>

    <div id="err" class="error" style="display:none;"></div>
    <div id="suggest" class="suggest"></div>
    <div id="result" class="result" style="display:none;"></div>

    <div class="legal">
      <div class="legal-note">※Station Walk Score(SWS)は交通利便性の一側面を示すものです。</div>

      <h2>運営者について</h2>
      <p>本サイトは個人が運営しています。</p>

      <h2>免責事項</h2>
      <p>本サイトで提供するSWS（Station Walk Score）は、交通利便性に関する一側面を数値化した参考指標です。</p>
      <p>本スコアは特定の不動産価値や投資判断、居住満足度を保証するものではありません。</p>
      <p>本サイトの情報を利用したことによって生じたいかなる損害についても、運営者は責任を負いません。</p>

      <h2>お問い合わせ</h2>
      <p>ご意見・不具合のご連絡はX（旧Twitter）DM または メール（stationwalkscore@gmail.com）までお願いします。</p>

    </div>
  </div>

  <script>
    // ★ここをあなたのAPI URLに変更（ローカル検証なら http://127.0.0.1:8001）
const API_BASE = "https://stationwalkscore.onrender.com";
const API_KEY  = "SWS_2025_9Qm7Vx1kP3rT8nL2aH6zY4cD0sW5uJ9e";
const url = `${API_BASE.replace(/\/$/, "")}/lookup?q=${encodeURIComponent(q)}&key=${encodeURIComponent(API_KEY)}`;

    const qEl = document.getElementById("q");
    const suggestEl = document.getElementById("suggest");
    const resultEl = document.getElementById("result");
    const btnEl = document.getElementById("btn");
    const errEl = document.getElementById("err");

    function showErr(msg) { errEl.style.display = "block"; errEl.textContent = msg; }
    function hideErr() { errEl.style.display = "none"; errEl.textContent = ""; }

    function escapeHtml(str) {
      return (str ?? "").toString().replace(/[&<>"']/g, function(m) {
        return ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"})[m];
      });
    }

    function renderResult(name, score) {
      resultEl.style.display = "block";
      resultEl.innerHTML = `
        <div class="name">${escapeHtml(name)}</div>
        <div class="muted">Station Walk Score</div>
        <div class="score">${Number(score).toFixed(0)}</div>
      `;
    }

    function clearSuggest() { suggestEl.innerHTML = ""; }

    async function getMatches(query) {
      const q = (query ?? "").trim();
      if (!q) return [];
      const url = `${API_BASE.replace(/\/$/, "")}/lookup?q=${encodeURIComponent(q)}`;
      const res = await fetch(url, { method: "GET" });
      if (!res.ok) throw new Error(`API error: ${res.status}`);
      const data = await res.json();
      return data.results || [];
    }

    function renderSuggest(items) {
      clearSuggest();
      if (!items.length) return;
      items.slice(0, 3).forEach(item => {
        const div = document.createElement("div");
        div.className = "suggest-item";
        div.textContent = item.name;
        div.addEventListener("click", () => {
          qEl.value = item.name;
          clearSuggest();
          renderResult(item.name, item.score);
        });
        suggestEl.appendChild(div);
      });
    }

    async function submit() {
      hideErr();
      try {
        const matches = await getMatches(qEl.value);
        if (matches.length) {
          renderResult(matches[0].name, matches[0].score);
          renderSuggest(matches);
        } else {
          clearSuggest();
          resultEl.style.display = "block";
          resultEl.innerHTML = `<div class="name">見つかりません</div><div class="muted">別の駅名で試してください</div>`;
        }
      } catch (e) {
        showErr("APIに接続できませんでした。APIが起動しているか、URL/CORS設定を確認してください。");
        console.error(e);
      }
    }

    let debounceTimer = null;
    qEl.addEventListener("input", () => {
      hideErr();
      clearTimeout(debounceTimer);
      const v = qEl.value;
      if (!v.trim()) { clearSuggest(); resultEl.style.display = "none"; return; }
      debounceTimer = setTimeout(async () => {
        try { renderSuggest(await getMatches(v)); } catch (e) { console.error(e); }
      }, 200);
    });

    qEl.addEventListener("keydown", (e) => { if (e.key === "Enter") { e.preventDefault(); submit(); }});
    btnEl.addEventListener("click", () => submit());
  </script>

  <script>
  function track(eventName, params = {}) {
    if (window.gtag) gtag('event', eventName, params);
  }
</script>

</body>
</html>
